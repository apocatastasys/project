#services:
 # - docker:dind
image: ubuntu:18.04

stages:
  - build
  - deploy

build_job:
  stage: build
  script:
    - apt-get update
    - apt install -y python3-pip
    - cd search_engine_ui
    - pwd
    - pip install -r requirements.txt
    - pwd
    - cd ui
    - pwd
    - FLASK_APP=ui.py gunicorn ui:app -b 178.154.201.156
    #docker build -t mongo:latest ./mongo

#deploy_job:
  #stage: deploy
  #script:
    #- docker run  -d --name mymongo -p 27017:27017 appuser/mongo-enterprise:4.0
  
    #- echo 'Deploy'
    #- cd search_engine_ui/ui && FLASK_APP=ui.py gunicorn ui:app -b 178.154.201.156
  
  variables:
    MONGO: 178.154.201.156
    MONGO_PORT: 27017
    DOCKER_USERNAME: appuser
    DOCKER_HOST: tcp://178.154.201.156:2376
    DOCKER_MACHINE_NAME: project-host
   # EXCLUDE_URLS: '.*github.com' python -u crawler/crawler.py https://vitkhab.github.io/search_engine_test_site/
    #RMQ_USERNAME: rabbit

